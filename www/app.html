<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>MapLarge App</title>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
</head>
<body>

    <div id="maplarge-app">
        <h1>Hello App!</h1>
        <div>
            <h3>Current: <span id="val-current"></span></h3>
            <ul id="children">
            </ul>
        </div>
    </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

<script type="text/javascript">

$( document ).ready(function() {

    var configs = Array;
    var current = null;

    var renderLink = function(title, href) {
        var html = '<a href="'+href+'">';
        html += title;
        html += '</a>';
        return html;
    };

    // First call server to get 'home'...

    (function () {
        return $.ajax({
            url: '/api/constants.php',
            type: 'GET'
        })
    })()
    .then( function(response) {
        configs = response.configs;
        //current = "/treeroot/foo";
        current = configs.home;
        $('#val-current').html(current);
        return $.ajax({
            url: '/api/index.php',
            type: 'GET',
            data: {
                src: current
            }
        })
    })
    .then( function(response) {
        var list = $("#maplarge-app ul#children");
        for (var i = 0; i < response.results.length; i++) {
            //list.append('<li>'+response.results[i].pathname+'</li>');
            list.append('<li>' + renderLink( response.results[i].pathname, response.results[i].pathname ) + '</li>');
        }
    })
    .fail( function(errResponse) {
        console.log('ERROR: ...');
    });


    /*
    (function () {
        return $.ajax({
            url: '/api/index.php',
            type: 'GET',
            data: {
                src: "/treeroot/foo"
            }
        })
    })()
    .then( function(response) {
        var list = $("#maplarge-app ul#children");
        for (var i = 0; i < response.results.length; i++) {
            list.append('<li>'+response.results[i].pathname+'</li>');
        }
    })
    .fail( function(errResponse) {
        console.log('ERROR: ...');
    });
    */

});
</script>

</body>
</html>
